<style>
  :root {
    --color-active: blue;
    --color-background: #eee;
    --border-radius: 0.4em;
  }
  body {
    font-family: Helvetica, Arial, sans-serif;
    background-color: var(--color-background);
  }

  .content-container {
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .content-container:not(.active) {
    display: none;
  }

  .title-container {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
  }
  .title {
    margin: 0;
  }

  .listicle {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    padding: 0;
    gap: 0.4em;
  }

  .status-assign-button {
    text-align: left;
    border: 0;
    padding: 0.4em 0.6em;
    background-color: #fff;
    cursor: pointer;
    transition: font-weight 0.2s ease-out;
  }
  .status-assign-button:hover {
    font-weight: 700;
  }

  #status-edit {
    list-style: none;
    padding: 0;
  }

  #status-edit li {
    display: flex;
    flex-direction: row;
  }

  #status-edit input {
    border: 1px solid #aaa;
    padding: 0.2em 0.4em;
  }

  .status-edit-marker {
    width: 2em;
    text-align: center;
    margin-right: -1px;
    border-radius: var(--border-radius) 0 0 var(--border-radius);
  }

  .status-edit-label {
    flex: 1;
    border-radius: 0 var(--border-radius) var(--border-radius) 0;
  }
</style>
<main class="content-container" id="assign-status-content">
  <h3 class="title">Assign Status</h3>
  <ul class="listicle" id="status-apply"></ul>
</main>
<main class="content-container" id="config-content">
  <div class="title-container">
    <h3 class="title">Configure</h3>
    <button class="option-new" onClick="addStatus()">Add</button>
  </div>
  <ul class="listicle" id="status-edit"></ul>
  <button class="save-button" onClick="saveChanges()">Save Changes</button>
</main>
<script>
  // functions exist before anything else so they can be called
  const tabClick = (e) => {
    const id = e.target.id;
    document.querySelectorAll("[id$='-content']").forEach((elem) => {
      elem.classList.remove("active");
    });

    document.querySelectorAll(`#${id}`).forEach((elem) => {
      elem.classList.add("active");
    });
  };

  const addStatus = (option) => {
    const markerInput = document.createElement("input");
    markerInput.value = option ? option.marker : "";
    markerInput.min = 1;
    markerInput.max = 1;
    markerInput.classList.add("status-edit-marker");

    const labelInput = document.createElement("input");
    labelInput.value = option ? option.label : "";
    labelInput.classList.add("status-edit-label");

    const container = document.createElement("li");
    container.appendChild(markerInput);
    container.appendChild(labelInput);

    document.querySelector("#status-edit").appendChild(container);
  };

  const saveChanges = () => {
    // get all markers
    const markers = document.querySelectorAll(".status-edit-marker");
    // get all labels
    const labels = document.querySelectorAll(".status-edit-label");

    // create an options object
    const _options = [];
    markers.forEach((val, k) => {
      _options.push({
        label: labels[k].value,
        marker: markers[k].value,
      });
    });

    // save changes
    parent.postMessage(
      { pluginMessage: { fn: "saveChanges", options: _options } },
      "*"
    );
  };

  const assignList = (options) => {
    options.map((option) => {
      // add options to select
      const elem = document.createElement("button");
      elem.textContent = `${option.marker} ${option.label}`;
      elem.classList.add("status-assign-button");
      elem.onclick = () =>
        parent.postMessage(
          { pluginMessage: { fn: "setTitle", state: option } },
          "*"
        );
      document.querySelector("#status-apply").appendChild(elem);

      // add options to configure
      addStatus(option);
    });
  };

  // get options from code.js
  let options = [];
  window.onmessage = (event) => {
    const msg = event.data.pluginMessage;

    switch (msg.type) {
      case "command":
        document
          .querySelector(`#${msg.command}-content`)
          .classList.add("active");
        break;
      case "options":
        assignList(msg.options);
        break;
    }
  };
</script>
